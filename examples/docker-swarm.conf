# ============================================================================
# Docker Swarm 集群配置示例
# ============================================================================
# 
# 适用场景:
# - Docker Swarm 集群环境
# - 多节点容器编排
# - 高可用容器部署
#
# 重要提示:
# - 请将 192.168.1.0/24 替换为您的实际集群网段
# - 确保所有 Swarm 节点都在同一网段或可互相访问
# - Manager 节点需要开放管理端口
# - Worker 节点只需开放通信端口
#
# ============================================================================

# ============================================
# SSH 访问 - 集群管理
# ============================================
ALLOW_PORT 22 tcp 192.168.1.0/24 集群节点SSH访问
ALLOW_PORT 22 tcp 10.20.30.40 管理员远程访问

# ============================================
# Docker Swarm 管理端口
# ============================================
# 用于集群管理的 TCP 端口
# Manager 节点必须开放此端口
ALLOW_PORT 2377 tcp 192.168.1.0/24 Swarm管理端口

# ============================================
# Docker Swarm 节点间通信
# ============================================
# 用于节点间通信的 TCP 和 UDP 端口
# 所有节点(Manager 和 Worker)都需要开放
ALLOW_PORT 7946 tcp 192.168.1.0/24 Swarm节点通信TCP
ALLOW_PORT 7946 udp 192.168.1.0/24 Swarm节点通信UDP

# ============================================
# Docker Overlay 网络
# ============================================
# 用于 overlay 网络流量的 UDP 端口
# 所有节点都需要开放
ALLOW_PORT 4789 udp 192.168.1.0/24 Swarm Overlay网络

# ============================================
# Docker Registry (私有镜像仓库)
# ============================================
# 如果使用私有 Docker Registry
# ALLOW_PORT 5000 tcp 192.168.1.0/24 Docker Registry

# ============================================
# Docker API (谨慎开放)
# ============================================
# 如果需要远程访问 Docker API
# 强烈建议使用 TLS 并限制访问
# ALLOW_PORT 2375 tcp 192.168.1.100 Docker API HTTP(不安全)
# ALLOW_PORT 2376 tcp 192.168.1.100 Docker API HTTPS(推荐)

# ============================================
# 容器服务端口
# ============================================
# 根据您部署的服务开放相应端口

# Web 服务
ALLOW_PORT 80 tcp 0.0.0.0/0 HTTP服务
ALLOW_PORT 443 tcp 0.0.0.0/0 HTTPS服务

# 自定义应用端口
# ALLOW_PORT 8080 tcp 0.0.0.0/0 应用服务1
# ALLOW_PORT 8081 tcp 0.0.0.0/0 应用服务2

# ============================================
# 负载均衡器
# ============================================
# Traefik
# ALLOW_PORT 8080 tcp 192.168.1.0/24 Traefik管理界面

# HAProxy
# ALLOW_PORT 8404 tcp 192.168.1.0/24 HAProxy统计页面

# Nginx
# ALLOW_PORT 8080 tcp 192.168.1.0/24 Nginx状态页面

# ============================================
# 监控和日志
# ============================================
# Prometheus (集群监控)
# ALLOW_PORT 9090 tcp 192.168.1.0/24 Prometheus

# Grafana (可视化)
# ALLOW_PORT 3000 tcp 192.168.1.0/24 Grafana

# cAdvisor (容器监控)
# ALLOW_PORT 8080 tcp 192.168.1.0/24 cAdvisor

# Portainer (容器管理)
# ALLOW_PORT 9000 tcp 192.168.1.0/24 Portainer
# ALLOW_PORT 8000 tcp 192.168.1.0/24 Portainer Edge

# ELK Stack (日志)
# ALLOW_PORT 9200 tcp 192.168.1.0/24 Elasticsearch
# ALLOW_PORT 5601 tcp 192.168.1.0/24 Kibana
# ALLOW_PORT 5044 tcp 192.168.1.0/24 Logstash

# ============================================
# 数据库集群 (运行在 Swarm 中)
# ============================================
# MySQL Galera Cluster
# ALLOW_PORT 3306 tcp 192.168.1.0/24 MySQL
# ALLOW_PORT 4444 tcp 192.168.1.0/24 Galera SST
# ALLOW_PORT 4567 tcp 192.168.1.0/24 Galera写集复制
# ALLOW_PORT 4568 tcp 192.168.1.0/24 Galera IST

# PostgreSQL HA
# ALLOW_PORT 5432 tcp 192.168.1.0/24 PostgreSQL

# Redis Cluster
# ALLOW_PORT 6379 tcp 192.168.1.0/24 Redis
# ALLOW_PORT 16379 tcp 192.168.1.0/24 Redis Cluster Bus

# ============================================
# 消息队列集群
# ============================================
# RabbitMQ Cluster
# ALLOW_PORT 5672 tcp 192.168.1.0/24 RabbitMQ AMQP
# ALLOW_PORT 15672 tcp 192.168.1.0/24 RabbitMQ管理界面
# ALLOW_PORT 25672 tcp 192.168.1.0/24 RabbitMQ节点间通信

# Kafka Cluster
# ALLOW_PORT 9092 tcp 192.168.1.0/24 Kafka
# ALLOW_PORT 2181 tcp 192.168.1.0/24 Zookeeper

# ============================================
# 服务网格 (Service Mesh)
# ============================================
# Consul
# ALLOW_PORT 8300 tcp 192.168.1.0/24 Consul Server RPC
# ALLOW_PORT 8301 tcp 192.168.1.0/24 Consul Serf LAN
# ALLOW_PORT 8301 udp 192.168.1.0/24 Consul Serf LAN
# ALLOW_PORT 8302 tcp 192.168.1.0/24 Consul Serf WAN
# ALLOW_PORT 8500 tcp 192.168.1.0/24 Consul HTTP API
# ALLOW_PORT 8600 tcp 192.168.1.0/24 Consul DNS
# ALLOW_PORT 8600 udp 192.168.1.0/24 Consul DNS

# ============================================
# 存储服务
# ============================================
# GlusterFS
# ALLOW_PORT 24007 tcp 192.168.1.0/24 GlusterFS Daemon
# ALLOW_PORT 24008 tcp 192.168.1.0/24 GlusterFS Management
# ALLOW_PORT 49152 tcp 192.168.1.0/24 GlusterFS Brick

# Ceph
# ALLOW_PORT 6789 tcp 192.168.1.0/24 Ceph Monitor
# ALLOW_PORT 6800-7300 tcp 192.168.1.0/24 Ceph OSD

# NFS
# ALLOW_PORT 2049 tcp 192.168.1.0/24 NFS
# ALLOW_PORT 111 tcp 192.168.1.0/24 Portmapper
# ALLOW_PORT 111 udp 192.168.1.0/24 Portmapper

# ============================================
# 健康检查和心跳
# ============================================
# 如果使用自定义健康检查端口
# ALLOW_PORT 8081 tcp 192.168.1.0/24 健康检查端点

# ============================================
# 特定节点角色配置
# ============================================

# Manager 节点额外配置:
# Manager 节点需要开放所有上述端口中标记的管理端口

# Worker 节点配置:
# Worker 节点主要需要开放通信端口和服务端口
# 可以关闭一些管理界面的访问

# ============================================
# 安全建议
# ============================================
# 1. 使用内网 IP 段，不要将 Swarm 管理端口暴露到公网
# 2. 启用 Docker TLS 认证
# 3. 定期更新 Docker 版本
# 4. 使用 secrets 管理敏感信息
# 5. 限制容器的系统调用能力
# 6. 使用网络策略限制容器间通信
# 7. 启用 Docker Content Trust
# 8. 定期备份 Swarm 配置

# ============================================
# 网段配置说明
# ============================================
# 请根据您的实际网络环境修改 192.168.1.0/24
# 可能的网段示例:
# - 192.168.1.0/24  (192.168.1.1 - 192.168.1.254)
# - 10.0.0.0/24     (10.0.0.1 - 10.0.0.254)
# - 172.16.0.0/16   (172.16.0.1 - 172.16.255.254)